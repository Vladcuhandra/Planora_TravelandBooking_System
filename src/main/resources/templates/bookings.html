<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Planora • Bookings</title>
    <link rel="icon" th:href="@{/favicon.ico}" type="image/x-icon">
</head>

<body>

<h2>All Bookings</h2>

<div class="mb-3" sec:authorize="hasRole('ADMIN')">
    <a th:href="@{/api/admin}" style="text-decoration:none;">
        <button type="button">← Go back to admin</button>
    </a>
</div>

<form action="/logout" method="post">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <button type="submit">Logout</button>
</form>

<hr>

<table th:if="${bookings != null and !bookings.isEmpty()}" border="1" cellpadding="8">
    <thead>
    <tr>
        <th>ID</th>
        <th>Trip</th>
        <th>Type</th>
        <th>Status</th>
        <th>Start</th>
        <th>End</th>
        <th>Transport</th>
        <th>Accommodation</th>
        <th>Total Price</th>
    </tr>
    </thead>

    <tbody>
    <tr th:each="b : ${bookings}">
        <td th:text="${b.id}"></td>
        <td th:text="${b.tripId}"></td>
        <td th:text="${b.bookingType}"></td>
        <td th:text="${b.status}"></td>
        <td th:text="${b.startDate}"></td>
        <td th:text="${b.endDate}"></td>
        <td th:text="${b.transportId}"></td>
        <td th:text="${b.accommodationId}"></td>
        <td th:text="${b.totalPrice}"></td>

        <td>
            <form th:action="@{/api/bookings/delete/{id}(id=${b.id})}"
                  method="post"
                  onsubmit="return confirm('Delete this booking?');">

                <input type="hidden" name="_method" value="delete" />
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <button type="submit">Delete</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<p th:if="${bookings == null or bookings.isEmpty()}">
    No bookings found.
</p>

<hr>

<h3>Create New Booking</h3>

<form th:action="@{/api/bookings/save}" th:object="${bookingDto}" method="post">

    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

    <label>Trip</label>
    <select th:field="*{tripId}" required>
        <option value="">-- Select --</option>
        <option th:each="t : ${trips}"
                th:value="${t.id}"
                th:text="${t.title + ' (id=' + t.id + ')'}">
        </option>
    </select>
    <br><br>

    <label>Booking Type</label>
    <select th:field="*{bookingType}" required>
        <option th:each="bt : ${bookingTypes}"
                th:value="${bt.name()}"
                th:text="${bt.name()}">
        </option>
    </select>
    <br><br>

    <label>Status</label>
    <select th:field="*{status}" required>
        <option th:each="st : ${bookingStatuses}"
                th:value="${st.name()}"
                th:text="${st.name()}">
        </option>
    </select>
    <br><br>

    <label>Start Date</label>
    <input type="datetime-local" th:field="*{startDate}" />
    <br><br>

    <label>End Date</label>
    <input type="datetime-local" th:field="*{endDate}" />
    <br><br>

    <label>Transport</label>
    <select th:field="*{transportId}">
        <option value="">-- None --</option>
        <option th:each="tr : ${transports}"
                th:value="${tr.id}"
                th:text="${tr.company + ' price=' + tr.price}">
        </option>
    </select>
    <br><br>

    <label>Accommodation</label>
    <select th:field="*{accommodationId}">
        <option value="">-- None --</option>
        <option th:each="a : ${accommodations}"
                th:value="${a.id}"
                th:text="${a.name + ' price/night=' + a.pricePerNight}">
        </option>
    </select>
    <br><br>

    <button type="submit">Save</button>

</form>

</body>
</html>
